<wdkModel>


  <!--===========================================================================-->
  <!-- Metrics   questions -->
  <!--  * scripts in https://github.com/VEuPathDB/MetricsReports/tree/main/usage/bin    -->
  <!--  * each script generates content for one or two tables in the database   -->
  <!--  * we start by making a question per database table -->
  <!--===========================================================================-->

  <questionSet name="MetricsQuestions" displayName="Search for Metrics">


    <!-- ************************************************************ -->
    <!-- Awstats                            -->
    <!-- ************************************************************ -->
    <question name="Awstats"
      displayName="Awstats"
      shortDisplayName="Awstats"
      queryRef="MetricsId.Awstats"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,unique_visitors,visits,page_data_requests,avg_visit_duration,bandwidth_gb"
        sorting="page_data_requests desc"
      />

      <summary>
        Report on awstats.
      </summary>

      <description>
       <![CDATA[ 
        <p>Report on metrics gathered by Awstats.  This information is ultimately derived from the apache log.</p>

	<p>Awstats does not reliably filter away robots, so these numbers might be inflated.</p>
       ]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center" 
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>


        <columnAttribute name="unique_visitors" displayName="# Unique visitors" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="visits" displayName="# Visits" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="page_data_requests" displayName="# Page data requests" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="avg_visit_duration" displayName="Average visit duration" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="bandwidth_gb" displayName="Bandwidth (GB)" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>

    <!-- ************************************************************ -->
    <!--  Login Stats       -->
    <!-- ************************************************************ -->
    <question name="LoginStats"
      displayName="LoginStats"
      shortDisplayName="Login Stats"
      queryRef="MetricsId.LoginStats"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,unique_logins,newly_registered,newly_registered_notLogin,total_registered"
        sorting="newly_registered desc"
      />

      <summary>
        Report on how many users logged in, and how many registered.
      </summary>

      <description>
       <![CDATA[ 
        <p>Report on how many users registered and how many users logged in during the time period.</p>

	<p>If a user logs in more than once during the time period, we only count once for that user.</p>

	<p>Because users commonly stay logged in for many months, this report does *not* tell us how many are currently logged in.  It only tells us how many went through the log in process during the time period.</p>

	<p>The stats are gathered from the account database and the account service logs.</p>
	]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="unique_logins" displayName="# Unique logins" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="newly_registered" displayName="# Newly registered users" align="center"
                         help="Includes registrations for *all* projects. (Registration is not project-specific)">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="newly_registered_notLogin" displayName="% Newly registered users who have not logged in" align="center"
                         help="Includes registrations for *all* projects. (Registration is not project-specific)">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="total_registered" displayName="# Total registered users" align="center" 
                         help="Includes registrations for *all* projects. (Registration is not project-specific)">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>

    <!-- ************************************************************ -->
    <!-- PageViewStats                            -->
    <!-- ************************************************************ -->
    <question name="PageViewStats"
      displayName="Page View Stats"
      shortDisplayName="PageViewStats"
      queryRef="MetricsId.PageViewStats"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,registered_users_count,registered_IP_count,registered_page_count,
                                       guest_users_count,guest_IP_count,guest_page_count,
                                       guest_users_regPage_pct,guest_IP_regPage_pct,guest_users_regPage_newly_registered_pct"
        sorting="registered_page_count desc"
      />

      <summary>
        Report on page views statistics
      </summary>

      <description>
       <![CDATA[ 
        <p>Report on page views and unique users, segregated by guest v. registered.</p>

        <p>Acquires data from the page-views log.  Attempts to filter bots based on the user-agent field.</p>
      ]]>

      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="registered_users_count" displayName="# Registered userIDs" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="registered_page_count" displayName="# Page views from registered users" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="guest_users_count" displayName="# Guest userIDs" align="center"
             help="We count a 'guest'access when the user visits: home page, static content, datasets and when the user sees a grayed out page beneath the login popup ">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="guest_page_count" displayName="# Page views from guests" align="center"
             help="We count a 'guest'access when the user visits: home page, static content, datasets and when the user sees a grayed out page beneath the login popup ">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="registered_IP_count" displayName="# Registered IPs" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="guest_IP_count" displayName="# Guest IPs" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="guest_IP_regPage_pct" displayName="% Guest IPs that go to registration page" align="center">
           <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="guest_users_regPage_pct" displayName="% Guest userIDs that go to registration page" align="center">
           <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="guest_users_regPage_newly_registered_pct" displayName="% Guest userIDs that did register" help="(over those go made it to the registration page)" align="center">
           <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>


    <!-- ************************************************************ -->
    <!-- Record page view stats                            -->
    <!-- ************************************************************ -->
    <question name="RecordPageViewStats"
      displayName="Record Page View Stats"
      shortDisplayName="RecordPageViewStats"
      queryRef="MetricsId.RecordPageViewStats"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,url_segment,count"
        sorting="count desc"
      />

      <summary>
        Report on Record pages from access logs.
      </summary>

      <description>
       <![CDATA[ 
        <p>Report on record pages accessed.</p>

        <p>Uses the apache log to find page-views that conform to our record page URLs.  Filter away bots (based on user-agent string).</p>
       ]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="url_segment" displayName="Data type" align="center">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="count" displayName="# Record page views" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>


    <!-- ************************************************************ -->
    <!-- User Datasets                            -->
    <!-- ************************************************************ -->
    <question name="UserDatasets"
      displayName="User Datasets"
      shortDisplayName="UserDatasets"
      queryRef="MetricsId.UserDatasets"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,dataset_type,new_complete,new_incomplete,total_complete,total_incomplete"
        sorting="new_complete desc"
      />

      <summary>
        Report on user datasets
      </summary>

      <description>
       <![CDATA[ 
        <p>Report on user datasets, segregated by user dataset type.</p>

	<p>Acquires data from the VDI admin/list-all-datasets endpoint</p>
       ]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="dataset_type" displayName="Dataset type" align="center">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="total_complete" displayName="# Total installed" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="new_complete" displayName="# Newly installed" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="total_incomplete" displayName="# Total incomplete" align="center"
                         help="A user dataset might not get fully installed for various reasons: failed import, failed metadata install or failed data install.">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="new_incomplete" displayName="# Newly incomplete" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>


    <!-- ************************************************************ -->
    <!-- Organism-related page views  stats                             -->
    <!-- ************************************************************ -->
    <question name="OrgPageViewMetrics"
      displayName="Record Page Views per Organism"
      shortDisplayName="PageViewsPerOrganism"
      queryRef="MetricsId.OrgPageViewMetrics"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,organism,is_reference,count,org_project"
        sorting="count desc"
      />

      <summary>
        Usage of record page views, per organism.
      </summary>

      <description>
       <![CDATA[ 
        <p>Count record page views per organism.  The record pages included are: genes, genomic sequences, snps and organism-specific datasets.</p>

	<p>Each time the user visits a record page associated with an organism, the web client makes a request to a dedicated "organism view" endpoint. These are tracked by prometheus, which is queried to produce this metric.</p>
      ]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="organism" displayName="Organism" align="center">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="org_project" displayName="Organism website" align="center">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="is_reference" displayName="Is reference?" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="count" displayName="# Record page views" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month">
                    <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>



    <!-- ************************************************************ -->
    <!--  Organism param stats  (1 script generates content for 2 tables) -->
    <!--    OrgParamCountMetrics:    projectId |  organismValueCount |  stepCount  -->
    <!--    OrgParamNameMetrics:    projectId |  organismName |  stepCount  -->
    <!-- ************************************************************ -->

    <question name="OrgParamCountMetrics"
      displayName="Number of organisms selected per search"
      shortDisplayName="OrganismCountPerSearch"
      queryRef="MetricsId.OrgParamCountMetrics"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,number_of_organisms,steps_count"
        sorting="number_of_organisms asc"
      />

      <summary>
        Report the number of searches that were paramterized by a particular number of organisms.
      </summary>

      <description>
       <![CDATA[ 
	<p>For searches that have an organism parameter, report a distribution of the number of searches with a specific count of organisms.  (For example, 370 searches run in this time period had three organisms in their organism parameter)</p>
	
	<p>This data is acquired from the organism parameter in steps stored in the user database.</p>
       ]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="number_of_organisms" displayName="# Organisms" align="center" help="Number of organisms selected for the search">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="steps_count" displayName="# Searches" align="center" help="Number of searches having a particular number of organisms selected">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>


    <question name="OrgParamNameMetrics"
      displayName="Number of Searches per Organism"
      shortDisplayName="SearchCountPerOrganism"
      queryRef="MetricsId.OrgParamNameMetrics"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,organism,is_reference,steps_count,org_project"
        sorting="steps_count desc"
      />

      <summary>
        For each organism, report how many searches were run.
      </summary>

      <description>
       <![CDATA[ 
       <p> For each organism, report how many searches were run using that organism as a parameter.</p>

       <p>This data is acquired from the organism parameter in steps stored in the user database.</p>
        ]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="organism" displayName="Organism" align="center">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="org_project" displayName="Organism website" align="center">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="is_reference" displayName="Is reference?" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="steps_count" displayName="# Searches" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>



    <!-- ************************************************************ -->
    <!-- Gene Page Tables                            -->
    <!-- ************************************************************ -->
    <question name="GenePageTableMetrics"
      displayName="Gene Page Table Requests"
      shortDisplayName="GeneTablesStats"
      queryRef="MetricsId.GenePageTableMetrics"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,table_name,count"
        sorting="count desc"
      />

      <summary>
	Reports on usage of individual WDK tables in the gene page.
      </summary>

      <description>
       <![CDATA[ 
        <p>Report on how often a user is shown a WDK table section in the gene page.  Counts sections that are open by default or that the user explicitly opened.</p>

	<p>This data is acquired from prometheus.  Using it, the WDK tracks when the data for a WDK table is requested.</p>
       ]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="table_name" displayName="Table name" align="center" help="These are sections in a gene page.">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="count" displayName="# Requests" align="center" 
             help="A request is made when the user opens a section in the geene page, and when the page is reloaded with the section opened.">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>



    <!-- ************************************************************ -->
    <!-- Tools                            -->
    <!-- ************************************************************ -->
    <question name="ToolMetrics"
      displayName="Tool Usage"
      shortDisplayName="ToolsStats"
      queryRef="MetricsId.ToolMetrics"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,tool,count"
        sorting="count desc"
      />

      <summary>
        Report on tool usage.
      </summary>

      <description>
       <![CDATA[ 
        <p>Report on tool usage.</p>

	<p>Uses the apache logs and the user database to find the usage stats.  Mignt include usage by robots.</p>
        ]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="tool" displayName="Tool" align="center">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="count" displayName="# Requests" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>


    <!-- ************************************************************ -->
    <!-- Searches: step count                            -->
    <!-- ************************************************************ -->
    <question name="SearchMetrics"
      displayName="Search popularity"
      shortDisplayName="Searches"
      queryRef="MetricsId.SearchMetrics"
      recordClassRef="MetricsRecordClasses.MetricsRecordClass"  >

      <attributesList
        summary="project_id,start_date,record_name,search_name,steps_count"
        sorting="steps_count desc"
      />

      <summary>
	Report the number of times each WDK search is used.
      </summary>

      <description>
       <![CDATA[ 
	<p>Report the number of times each WDK search is used.</p>

        <p>To get the data, we count in the user database the number of steps that use each step.</p>
       ]]>
      </description>

      <dynamicAttributes>

        <columnAttribute name="project_id" displayName="Project collected" align="center"
                         help="Stats collected in this project/website; if 'Unknown' it could be any number of websites,  
                               a subset of requests within the time period requested">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="record_name" displayName="Data type" align="center">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="search_name" displayName="Search name" align="center">
          <reporter name="wordCloud" displayName="Word Cloud" scopes=""
                    implementation="org.eupathdb.common.model.report.EbrcWordCloudAttributeReporter">
            <description>
              <![CDATA[ Display the terms in the attribute as word clouds ]]>
            </description>
          </reporter>
        </columnAttribute>

        <columnAttribute name="steps_count" displayName="# Steps" align="center">
          <reporter name="histogram" displayName="Histogram" scopes=""
                    implementation="org.gusdb.wdk.model.report.reporter.HistogramAttributeReporter">
            <description>Display the histogram of the values of this attribute</description>
            <property name="type">int</property>
          </reporter>
        </columnAttribute>

        <columnAttribute name="start_date" displayName="Month"/>
        <columnAttribute name="end_date" displayName="End date"/>

      </dynamicAttributes>

    </question>

  </questionSet>


</wdkModel>

